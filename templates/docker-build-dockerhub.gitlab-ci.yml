variables:
  PIPES_VERSION: latest
  DOCKER_REGISTRY: ""
  DOCKER_REGISTRY_USERNAME: $DOCKERHUB_USERNAME
  DOCKER_REGISTRY_PASSWORD: $DOCKERHUB_PASSWORD
  DOCKER_IMAGE_NAME: $DOCKER_IMAGE_NAME
  DOCKER_IMAGE_TAGS: $CI_BUILD_REF_NAME
  DOCKERFILE_CONTEXT: "."
  GITLAB_CI_ARCH: amd64

include:
  - project: devops/pipes
    file: /templates/docker-manifest.gitlab-ci.yml

stages:
  - docker
  - post

build-docker-image:
  stage: docker
  image: cenk1cenk2/pipe-docker:${PIPES_VERSION}
  script:
    - pipe build
  artifacts:
    paths:
      - .published-docker-images*
      - "**/.published-docker-images*"
  tags:
    - ${GITLAB_CI_ARCH}
