---
stages:
  - bootstrap
  - pipes

dummy:
  stage: bootstrap
  image: alpine:latest
  script:
    - echo "imdat"
  tags:
    - docker

bootstrap:
  stage: bootstrap
  trigger:
    strategy: depend
    include:
      - local: .gitlab-ci.bootstrap.yml
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      changes:
        paths:
          - .gitlab-ci.next.yml
          - .gitlab-ci.bootstrap.yml
          - go/
          - buildah/
    - if: $CI_COMMIT_TAG

go:
  stage: pipes
  trigger:
    strategy: depend
    include:
      - local: .gitlab-ci.pipe.yml
        inputs:
          cwd: ./go
          container-image-name: cenk1cenk2/pipe-go2
          container-matrix:
            - CONTAINER_FILE_NAME: Dockerfile
              CONTAINER_IMAGE_BUILD_ARGS: |-
                GO_VERSION: '{{ env "GO_VERSION" }}'
              CONTAINER_IMAGE_TAGS: |-
                {{ env "GO_VERSION" }}
              GO_VERSION:
                - 1.25-alpine
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      changes:
        paths:
          - .gitlab-ci.next.yml
          - .gitlab-ci.pipe.yml
          - go/
    - if: $CI_COMMIT_TAG

buildah:
  stage: pipes
  trigger:
    strategy: depend
    include:
      - local: .gitlab-ci.pipe.yml
        inputs:
          cwd: ./buildah
          container-image-name: cenk1cenk2/pipe-buildah
          container-matrix:
            - CONTAINER_FILE_NAME: Dockerfile
              CONTAINER_IMAGE_BUILD_ARGS: |-
                BUILDAH_VERSION: '{{ env "BUILDAH_VERSION" }}'
              CONTAINER_IMAGE_TAGS: |-
                {{ env "BUILDAH_VERSION" }}
              BUILDAH_VERSION:
                - latest
  rules:
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      changes:
        paths:
          - .gitlab-ci.next.yml
          - .gitlab-ci.pipe.yml
          - buildah/
    - if: $CI_COMMIT_TAG
